@model CSDLPT.Web.Models.TranDauDetailsViewModel
@{
    ViewData["Title"] = "Chi tiết Trận Đấu";
}
<hr />
@{
    // SỬA 1: Đã sửa GetValueOrDefault
    var tenDoiNha = Model.TenDoiBongLookup.ContainsKey(Model.TranDau.MaDoiNha)
                    ? Model.TenDoiBongLookup[Model.TranDau.MaDoiNha]
                    : Model.TranDau.MaDoiNha;

    var tenDoiKhach = Model.TenDoiBongLookup.ContainsKey(Model.TranDau.MaDoiKhach)
                      ? Model.TenDoiBongLookup[Model.TranDau.MaDoiKhach]
                      : Model.TranDau.MaDoiKhach;
}

<h2 style="text-align:center;">
    @tenDoiNha
    <span class="badge badge-primary" style="font-size: 1.1em; padding: 10px;">@Model.TongSoTrai_DoiNha</span>
    -
    <span class="badge badge-secondary" style="font-size: 1.1em; padding: 10px;">@Model.TongSoTrai_DoiKhach</span>
    @tenDoiKhach
</h2>
<hr />
<h3>Thêm nhanh Cầu thủ vào Trận</h3>
<form asp-action="BatchAddThamGia" method="post">
    <input type="hidden" name="MaTD" value="@Model.TranDau.MaTD" />
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <div class="row">
        <div class="col-md-6">
            <h4>
                Đội nhà: @tenDoiNha
            </h4>

            @if (!Model.CauThuDoiNha_ChuaThamGia.Any())
            {
                <p class="text-muted">Tất cả cầu thủ đội nhà đã được thêm.</p>
            }
            else
            {
                <div style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
                    @foreach (var ct in Model.CauThuDoiNha_ChuaThamGia)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="SelectedCauThuIds" value="@ct.MaCT" id="ct_@ct.MaCT">
                            <label class="form-check-label" for="ct_@ct.MaCT">
                                @ct.HoTen (@ct.MaCT)
                            </label>
                        </div>
                    }
                </div>
            }
        </div>

        <div class="col-md-6">
            <h4>
                Đội khách: @tenDoiKhach
            </h4>

            @if (!Model.CauThuDoiKhach_ChuaThamGia.Any())
            {
                <p class="text-muted">Tất cả cầu thủ đội khách đã được thêm.</p>
            }
            else
            {
                <div style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
                    @foreach (var ct in Model.CauThuDoiKhach_ChuaThamGia)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="SelectedCauThuIds" value="@ct.MaCT" id="ct_@ct.MaCT">
                            <label class="form-check-label" for="ct_@ct.MaCT">
                                @ct.HoTen (@ct.MaCT)
                            </label>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <div class="form-group mt-3">
        <input type="submit" value="Thêm các cầu thủ đã chọn" class="btn btn-success" />
    </div>
</form>

<hr />

<h3>
    Đội nhà đã tham gia (@Model.DanhSachThamGia_DoiNha.Count)
</h3>

@if (Model.DanhSachThamGia_DoiNha.Count == 0)
{
    <p class="text-muted">Chưa có cầu thủ đội nhà nào tham gia.</p>
}
else
{
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Mã Cầu Thủ</th>
                <th>Tên Cầu Thủ</th>
                <th>Số Trái (Bàn thắng)</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.DanhSachThamGia_DoiNha)
            {
                <tr>
                    <td>@item.MaCT</td>
                    <td>
                        @(Model.TenCauThuLookup.ContainsKey(item.MaCT) ? Model.TenCauThuLookup[item.MaCT] : "Không rõ")
                    </td>
                    <td>
                        <form asp-action="UpdateThamGiaSoTrai" method="post" class="form-inline">
                            <input type="hidden" name="MaTD" value="@item.MaTD" />
                            <input type="hidden" name="MaCT" value="@item.MaCT" />
                            <input type="number" name="SoTrai" value="@item.SoTrai" class="form-control form-control-sm" style="width: 70px;" min="0" />
                            <button type="submit" class="btn btn-outline-primary btn-sm ml-1">Lưu</button>
                        </form>
                    </td>
                    <td>
                        <form asp-action="DeleteThamGia" method="post" onsubmit="return confirm('Bạn có chắc muốn xóa cầu thủ này?');">
                            <input type="hidden" name="MaTD" value="@item.MaTD" />
                            <input type="hidden" name="MaCT" value="@item.MaCT" />
                            <button type="submit" class="btn btn-danger btn-sm">Xóa</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<hr />

<h3>
    Đội khách đã tham gia (@Model.DanhSachThamGia_DoiKhach.Count)
</h3>

@if (Model.DanhSachThamGia_DoiKhach.Count == 0)
{
    <p class="text-muted">Chưa có cầu thủ đội khách nào tham gia.</p>
}
else
{
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Mã Cầu Thủ</th>
                <th>Tên Cầu Thủ</th>
                <th>Số Trái (Bàn thắng)</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.DanhSachThamGia_DoiKhach)
            {
                <tr>
                    <td>@item.MaCT</td>
                    <td>
                        @(Model.TenCauThuLookup.ContainsKey(item.MaCT) ? Model.TenCauThuLookup[item.MaCT] : "Không rõ")
                    </td>
                    <td>
                        <form asp-action="UpdateThamGiaSoTrai" method="post" class="form-inline">
                            <input type="hidden" name="MaTD" value="@item.MaTD" />
                            <input type="hidden" name="MaCT" value="@item.MaCT" />
                            <input type="number" name="SoTrai" value="@item.SoTrai" class="form-control form-control-sm" style="width: 70px;" min="0" />
                            <button type="submit" class="btn btn-outline-primary btn-sm ml-1">Lưu</button>
                        </form>
                    </td>
                    <td>
                        <form asp-action="DeleteThamGia" method="post" onsubmit="return confirm('Bạn có chắc muốn xóa cầu thủ này?');">
                            <input type="hidden" name="MaTD" value="@item.MaTD" />
                            <input type="hidden" name="MaCT" value="@item.MaCT" />
                            <button type="submit" class="btn btn-danger btn-sm">Xóa</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}